<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GhostWall Dashboard</title>
    <style>
        body { background-color: #0f1115; color: #f1f5f9; font-family: 'Segoe UI', sans-serif; padding: 2rem;}
        h1 { color: #3b82f6; }
        h3 { color: #e2e8f0; margin-top: 1.5rem; }
        p, li { color: #cbd5e1; line-height: 1.6; }
        ul { margin-left: 1.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem;}
        th, td { padding: 0.75rem; border: 1px solid #334155; text-align: left;}
        .human { background-color: #1a2e1f; }
        .bot { background-color: #3f1e1e; }
        .denied { background-color: #5a1e1e; }
    </style>
</head>
<body>
<nav style="position: absolute; top: 1rem; left: 1rem;">
    <select onchange="location = this.value;" style="padding: 0.5rem; font-size: 1rem;">
        <option selected disabled>Menu</option>
        <option value="/">Home</option>
        <option value="/dashboard">Dashboard</option>
    </select>
</nav>

<h1>Visitor Log Dashboard</h1>
<div style="margin-top: 1rem; margin-bottom: 2rem;">
    <h3>Current GhostWall Bot Detection</h3>
    <p>
        GhostWall protects your site with layered, real-time bot detection. All visits are logged with IP, user agent, timestamp, and type. Bots are instantly denied and logged. Use the username box below to filter logs by site/client.
    </p>
</div>
<button id="clear-log-button" style="padding: 0.5rem 1rem; background-color: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Clear Log
</button>
<p id="clear-status" style="margin-top:10px; color:#94a3b8;"></p>
<div style="margin-top:20px;">
    <input type="text" id="username-input" placeholder="Enter username (Ghost or Sherm)" style="padding:0.5rem; border-radius:4px;">
    <button id="login-btn" style="padding:0.5rem 1rem; border-radius:4px; background:#3b82f6; color:white; border:none; margin-left:10px;">Login</button>
</div>
<table id="log-table" style="margin-top:30px; display:none;">
    <thead>
        <tr>
            {% for col in columns %}
                <th>{{ col }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody id="log-table-body">
        {% for row in rows %}
            <tr class="{{ row[3]|lower }}"
                data-details="{{ row[4]|e }}"
                data-type="{{ row[3]|lower }}"
                data-ua="{{ row[2]|lower }}">
                {% for cell in row %}
                    <td>{{ cell }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>
<script>
document.getElementById('clear-log-button').addEventListener('click', function () {
    fetch('/clear')
        .then(response => {
            if (response.ok) {
                document.getElementById('clear-status').textContent = 'Log cleared successfully.';
                location.reload();
            } else {
                document.getElementById('clear-status').textContent = 'Failed to clear log.';
            }
        })
        .catch(() => {
            document.getElementById('clear-status').textContent = 'Error while clearing log.';
        });
});
window.onload = function () {
    document.getElementById('log-table').style.display = "none";
    let rows = document.querySelectorAll('#log-table tbody tr');
    rows.forEach(tr => tr.style.display = 'none');
};
document.getElementById('login-btn').onclick = function () {
    let username = document.getElementById('username-input').value.trim();
    let rows = Array.from(document.querySelectorAll('#log-table tbody tr'));
    let anyVisible = false;
    if (username === "Ghost") {
        rows.forEach(tr => {
            let details = (tr.getAttribute('data-details') || '').toLowerCase();
            if (
                details.includes('remote js log') ||
                details.includes('logged from external js client') ||
                details.includes('test client')
            ) {
                tr.style.display = "none";
            } else {
                tr.style.display = "";
                anyVisible = true;
            }
        });
    } else if (username === "Sherm") {
        rows.forEach(tr => {
            let details = (tr.getAttribute('data-details') || '').toLowerCase();
            if (
                details.includes('remote js log') ||
                details.includes('logged from external js client') ||
                details.includes('test client')
            ) {
                tr.style.display = "";
                anyVisible = true;
            } else {
                tr.style.display = "none";
            }
        });
    } else {
        rows.forEach(tr => tr.style.display = "none");
    }
    document.getElementById('log-table').style.display = anyVisible ? "" : "none";
};
</script>
</body>
</html>
