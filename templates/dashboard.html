<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GhostLink Dashboard</title>
    <style>
        body {
            background-color: #0f1115;
            color: #f1f5f9;
            font-family: 'Segoe UI', sans-serif;
            padding: 2rem;
        }

        h1 {
            color: #3b82f6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        th, td {
            padding: 0.75rem;
            border: 1px solid #334155;
            text-align: left;
        }

        .human { background-color: #1a2e1f; }
        .bot { background-color: #3f1e1e; }
        .denied { background-color: #5a1e1e; }
    </style>
</head>
<body>
<nav style="position: absolute; top: 1rem; left: 1rem;">
    <select onchange="location = this.value;" style="padding: 0.5rem; font-size: 1rem;">
        <option selected disabled>Menu</option>
        <option value="/">Home</option>
        <option value="/dashboard">Dashboard</option>
    </select>
</nav>
    <h1>Visitor Log Dashboard</h1>
    <h4>
    GhostLink tracks key metadata about every visitor to your site — including IP address, user agent, timestamp, and bot status.
    <br><br>
    It uses a combination of bot mitigation techniques:
    <ul>
        <li><strong>robots.txt:</strong> Blocks compliant crawlers like Googlebot and Bingbot.</li>
        <li><strong>User-Agent detection:</strong> Flags bots by scanning for common identifiers (e.g. "bot", "crawler", "python-requests").</li>
        <li><strong>Header analysis:</strong> Detects non-browser traffic with missing or suspicious headers.</li>
        <li><strong>Real-time logging:</strong> Every visit is recorded and classified as <em>human</em> or <em>bot</em>, with bots optionally blocked from accessing content.</li>
    </ul>
    This dashboard gives you complete visibility into who’s visiting your site — and who’s trying to scrape it. Clients will be able to sign in and view their sites information here with
        more info, such as charts and trends. Other future features could include toggling access or adding paywalls for some specific bots or.
</h4>


<button id="clear-log-button" style="padding: 0.5rem 1rem; background-color: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Clear Log
</button>
<button id="toggle-robots" style="margin-left: 1rem; padding: 0.5rem 1rem; background-color: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Toggle robots.txt
</button>
<p id="robots-status" style="margin-top:10px; color:#94a3b8;"></p>

<p id="clear-status" style="margin-top:10px; color:#94a3b8;"></p>

    <table>
        <thead>
            <tr>
                {% for col in columns %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
                <tr class="{{ row[3]|lower }}">
                    {% for cell in row %}
                        <td>{{ cell }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
<script>
document.getElementById('clear-log-button').addEventListener('click', function () {
    fetch('/clear')
        .then(response => {
            if (response.ok) {
                document.getElementById('clear-status').textContent = 'Log cleared successfully.';
                location.reload(); // refresh the page to update the log table
            } else {
                document.getElementById('clear-status').textContent = 'Failed to clear log.';
            }
        })
        .catch(() => {
            document.getElementById('clear-status').textContent = 'Error while clearing log.';
        });
});
</script>
<script>
document.getElementById('toggle-robots').addEventListener('click', function () {
    fetch('/toggle-robots', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            document.getElementById('robots-status').textContent =
                data.robots_enabled ? 'robots.txt is ENABLED (bots will see it)' : 'robots.txt is DISABLED (bots won’t see it)';
        })
        .catch(() => {
            document.getElementById('robots-status').textContent = 'Error toggling robots.txt';
        });
});
</script>

</body>
</html>
