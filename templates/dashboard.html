<button id="clear-log-button" style="padding: 0.5rem 1rem; background-color: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Clear Log
</button>
<p id="clear-status" style="margin-top:10px; color:#94a3b8;"></p>

<!-- Username Filter -->
<div style="margin-top:20px;">
    <input type="text" id="username-input" placeholder="Enter username (Ghost or Sherm)" style="padding:0.5rem; border-radius:4px;">
    <button id="login-btn" style="padding:0.5rem 1rem; border-radius:4px; background:#3b82f6; color:white; border:none; margin-left:10px;">Login</button>
</div>

<table id="log-table">
    <thead>
        <tr>
            {% for col in columns %}
                <th>{{ col }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody id="log-table-body">
        {% for row in rows %}
            <tr class="{{ row[3]|lower }}">
                {% for cell in row %}
                    <td>{{ cell }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
document.getElementById('clear-log-button').addEventListener('click', function () {
    fetch('/clear')
        .then(response => {
            if (response.ok) {
                document.getElementById('clear-status').textContent = 'Log cleared successfully.';
                location.reload();
            } else {
                document.getElementById('clear-status').textContent = 'Failed to clear log.';
            }
        })
        .catch(() => {
            document.getElementById('clear-status').textContent = 'Error while clearing log.';
        });
});

// Filter logs based on username
document.getElementById('login-btn').onclick = function () {
    let username = document.getElementById('username-input').value.trim();
    let rows = Array.from(document.querySelectorAll('#log-table tbody tr'));
    rows.forEach(tr => {
        let details = tr.children[4].textContent || '';
        if (username === "Ghost") {
            // Show only logs from original ghostlink site
            if (details === "" || details.includes("Pageview (JS not yet checked)")) {
                tr.style.display = "";
            } else {
                tr.style.display = "none";
            }
        } else if (username === "Sherm") {
            // Show only logs from the test site
            if (details.includes("Remote JS log") || details.includes("Logged from external JS client")) {
                tr.style.display = "";
            } else {
                tr.style.display = "none";
            }
        } else {
            // Show nothing for other usernames
            tr.style.display = "none";
        }
    });
};
</script>